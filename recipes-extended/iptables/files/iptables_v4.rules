*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# LAN <-> LAN (bridge)
-A FORWARD -i br0.lan -o br0.lan -j ACCEPT

# LAN -> uplinks
-A FORWARD -i br0.lan -o vlan0.uplink -j ACCEPT
-A FORWARD -i br0.lan -o vlan1.uplink -j ACCEPT
-A FORWARD -i br0.lan -o wwan0 -j ACCEPT
-A FORWARD -i br0.lan -o wlan0.uplink -j ACCEPT

# uplinks -> LAN (stateful)
-A FORWARD -i vlan0.uplink -o br0.lan -m state --state ESTABLISHED,RELATED -j ACCEPT
-A FORWARD -i vlan1.uplink -o br0.lan -m state --state ESTABLISHED,RELATED -j ACCEPT
-A FORWARD -i wlan0.uplink -o br0.lan -m state --state ESTABLISHED,RELATED -j ACCEPT
-A FORWARD -i wwan0 -o br0.lan -m state --state ESTABLISHED,RELATED -j ACCEPT

COMMIT

*nat
:PREROUTING ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

-A POSTROUTING -o vlan0.uplink -j MASQUERADE
-A POSTROUTING -o vlan1.uplink -j MASQUERADE
-A POSTROUTING -o wlan0.uplink -j MASQUERADE
-A POSTROUTING -o wwan0 -j MASQUERADE

COMMIT
